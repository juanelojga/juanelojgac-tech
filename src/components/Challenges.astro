---
interface Props {
  lang: "en" | "es";
}

const { lang } = Astro.props;

// Import translations
const translations = await import(`../i18n/${lang}.json`);
const t = translations.default.challenges;

// Challenge items configuration
const challenges = [
  {
    id: "tab-1",
    heading: t.tabs[0].heading,
    description: t.tabs[0].description,
    image: "/assets/images/challenges/automating.jpg",
    imageAlt: t.tabs[0].imageAlt,
  },
  {
    id: "tab-2",
    heading: t.tabs[1].heading,
    description: t.tabs[1].description,
    image: "/assets/images/challenges/building.jpg",
    imageAlt: t.tabs[1].imageAlt,
  },
  {
    id: "tab-3",
    heading: t.tabs[2].heading,
    description: t.tabs[2].description,
    image: "/assets/images/challenges/content.jpg",
    imageAlt: t.tabs[2].imageAlt,
  },
];
---

<section
  id="challenges"
  class="bg-color-scheme-3-background px-[5%] py-16 md:py-24 lg:py-28"
  aria-labelledby="challenges-section"
>
  <div class="container mx-auto max-w-[1280px]">
    <div class="grid grid-cols-1 items-center gap-y-12 md:grid-cols-2 md:gap-x-12 lg:gap-x-20">
      <!-- Tabs Menu -->
      <div
        role="tablist"
        aria-orientation="horizontal"
        class="col-start-1 col-end-2 row-start-1 row-end-2 grid grid-cols-1 items-center gap-y-10"
        id="challenges-tablist"
      >
        {
          challenges.map((challenge, index) => (
            <button
              type="button"
              role="tab"
              aria-selected={index === 0 ? "true" : "false"}
              aria-controls={`panel-${challenge.id}`}
              id={`trigger-${challenge.id}`}
              data-tab-id={challenge.id}
              class:list={[
                "flex flex-col items-start justify-center border-0 border-l-2 border-transparent px-0 py-0 pl-8 text-left whitespace-normal transition-all focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50",
                "text-color-scheme-3-text h-[130px] overflow-hidden",
                {
                  "border-white": index === 0,
                },
                "cursor-pointer",
              ]}
              data-index={index}
            >
              <h3 class="font-sora mb-3 w-full text-2xl leading-[1.3] font-semibold tracking-[-0.4px] md:mb-4 md:text-3xl lg:text-3xl">
                {challenge.heading}
              </h3>
              <p class="md:text-md w-full text-base leading-[1.5]">{challenge.description}</p>
            </button>
          ))
        }
      </div>

      <!-- Tabs Content -->
      <div
        class="relative flex max-h-full w-full items-center justify-center overflow-hidden"
        id="challenges-content"
      >
        {
          challenges.map((challenge, index) => (
            <div
              role="tabpanel"
              aria-labelledby={`trigger-${challenge.id}`}
              id={`panel-${challenge.id}`}
              tabindex="0"
              data-tab-id={challenge.id}
              class:list={[
                "transition-opacity duration-300 focus-visible:outline-none",
                {
                  "block opacity-100": index === 0,
                  "hidden opacity-0": index !== 0,
                },
              ]}
            >
              <img
                src={challenge.image}
                alt={challenge.imageAlt}
                class="size-full max-w-[600px] object-cover"
              />
            </div>
          ))
        }
      </div>
    </div>
  </div>
</section>

<script>
  // Tab interaction logic
  function initializeTabs() {
    const tablist = document.getElementById("challenges-tablist");
    if (!tablist) return;

    const tabs = tablist.querySelectorAll<HTMLButtonElement>('[role="tab"]');
    const panels = document.querySelectorAll<HTMLDivElement>('[role="tabpanel"]');

    // Set initial state
    tabs.forEach((tab, index) => {
      const isActive = index === 0;
      tab.setAttribute("aria-selected", isActive.toString());
      if (isActive) {
        tab.classList.add("border-white");
      } else {
        tab.classList.remove("border-white");
      }
    });

    // Handle tab clicks
    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const tabId = tab.getAttribute("data-tab-id");
        if (!tabId) return;

        // Update all tabs
        tabs.forEach((t) => {
          const isSelected = t.getAttribute("data-tab-id") === tabId;
          t.setAttribute("aria-selected", isSelected.toString());

          if (isSelected) {
            t.classList.add("border-white");
          } else {
            t.classList.remove("border-white");
          }
        });

        // Update all panels
        panels.forEach((panel) => {
          const panelId = panel.getAttribute("data-tab-id");
          const isActive = panelId === tabId;

          if (isActive) {
            panel.classList.remove("hidden", "opacity-0");
            panel.classList.add("block", "opacity-100");
          } else {
            panel.classList.remove("block", "opacity-100");
            panel.classList.add("hidden", "opacity-0");
          }
        });
      });

      // Keyboard navigation
      tab.addEventListener("keydown", (e) => {
        const currentIndex = parseInt(tab.getAttribute("data-index") || "0");
        let newIndex = currentIndex;

        if (e.key === "ArrowDown" || e.key === "ArrowRight") {
          e.preventDefault();
          newIndex = (currentIndex + 1) % tabs.length;
        } else if (e.key === "ArrowUp" || e.key === "ArrowLeft") {
          e.preventDefault();
          newIndex = (currentIndex - 1 + tabs.length) % tabs.length;
        } else if (e.key === "Home") {
          e.preventDefault();
          newIndex = 0;
        } else if (e.key === "End") {
          e.preventDefault();
          newIndex = tabs.length - 1;
        }

        if (newIndex !== currentIndex) {
          tabs[newIndex].click();
          tabs[newIndex].focus();
        }
      });
    });
  }

  // Initialize on page load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initializeTabs);
  } else {
    initializeTabs();
  }
</script>
