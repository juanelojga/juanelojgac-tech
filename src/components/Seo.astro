---
/**
 * Advanced SEO Component - AI-Focused Semantic SEO with Structured Data
 *
 * Manages all SEO and social media metadata with enhanced Schema.org structured data.
 * Implements keyword-rich meta descriptions and bilingual AI-focused service schemas.
 * Supports English and Spanish with full Open Graph, Twitter Card, and Schema.org integration.
 *
 * Note: The `lang` attribute should be set on the <html> tag in your Layout file.
 */

import enTranslations from "../i18n/en.json";
import esTranslations from "../i18n/es.json";

interface Props {
  title: string;
  description?: string;
  url: string;
  lang: "en" | "es";
  image?: string;
}

const { title, description: customDescription, lang, image } = Astro.props;

// Get translations based on language
const translations = lang === "en" ? enTranslations : esTranslations;
const seo = translations.seo;

/**
 * Generate keyword-rich meta description
 * Combines page title with AI-focused keywords for optimal SEO
 */
function generateKeywordRichDescription(
  pageTitle: string,
  customDesc: string | undefined,
  keywords: string[],
  defaultDesc: string
): string {
  if (customDesc) {
    return customDesc;
  }

  // Create a keyword-rich description by combining title with top keywords
  const keywordPhrase = keywords.slice(0, 2).join(", ");
  return `${pageTitle} - ${keywordPhrase} solutions for startups and SMEs. ${defaultDesc}`;
}

// Generate optimized description
const description = generateKeywordRichDescription(
  title,
  customDescription,
  seo.keywordsList,
  seo.defaultDescription
);

// Construct full URLs using Astro.site for dynamic base URL
const baseUrl = Astro.site ? Astro.site.origin : "https://juanelojgac-tech.com";
const canonicalUrl = new URL(Astro.url.pathname, Astro.site).toString();
const alternateUrl =
  lang === "en"
    ? new URL(`/es${Astro.url.pathname}`, Astro.site).toString()
    : new URL(Astro.url.pathname.replace("/es", ""), Astro.site).toString();

// OG Image with AI-inspired default
const ogImage = image ? `${baseUrl}${image}` : `${baseUrl}${seo.defaultImage.url}`;
const ogImageAlt = image ? title : seo.defaultImage.alt;

// Alternate language
const alternateLang = lang === "en" ? "es" : "en";
const alternateLocale = lang === "en" ? "es_ES" : "en_US";
const currentLocale = lang === "en" ? "en_US" : "es_ES";

// Page title with site name
const fullTitle = `${title} | ${seo.siteName}`;

/**
 * Enhanced Organization Schema with AI focus
 */
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": `${baseUrl}/#organization`,
  name: seo.organization.name,
  url: baseUrl,
  logo: {
    "@type": "ImageObject",
    url: `${baseUrl}/favicon.ico`,
    width: "64",
    height: "64",
  },
  description: seo.organization.description,
  slogan: seo.organization.slogan,
  foundingDate: "2024",
  founders: [
    {
      "@type": "Person",
      name: "Juan Almeida",
    },
  ],
  contactPoint: {
    "@type": "ContactPoint",
    email: "juan.almeida@juanelojgac-tech.com",
    contactType: "Customer Service",
    availableLanguage: ["English", "Spanish"],
  },
  areaServed: [
    {
      "@type": "Country",
      name: "United States",
    },
    {
      "@type": "Country",
      name: "Ecuador",
    },
    {
      "@type": "Place",
      name: "Latin America",
    },
  ],
  sameAs: [
    "https://twitter.com/juanelojgac",
    "https://linkedin.com/company/juanelojgac-tech",
    "https://instagram.com/juanelojgac",
  ],
  knowsAbout: [
    "Artificial Intelligence",
    "Machine Learning",
    "Automation",
    "Digital Transformation",
    "Web Development",
    "AI Marketing",
  ],
};

/**
 * Service Schemas - AI-focused service offerings
 * Includes detailed structured data for each core service
 */
const serviceSchemas = seo.services.map((service, index) => ({
  "@context": "https://schema.org",
  "@type": "Service",
  "@id": `${baseUrl}/#service-${index + 1}`,
  serviceType: service.serviceType,
  name: service.name,
  description: service.description,
  provider: {
    "@id": `${baseUrl}/#organization`,
  },
  areaServed: service.areaServed.map((area) => ({
    "@type": area === "United States" || area === "Estados Unidos" ? "Country" : "Place",
    name: area,
  })),
  offers: {
    "@type": "Offer",
    priceRange: service.priceRange,
    priceCurrency: "USD",
    availability: "https://schema.org/InStock",
  },
  category: "AI Solutions",
  audience: {
    "@type": "Audience",
    audienceType: "Startups and SMEs",
  },
}));

/**
 * WebSite Schema for site-level information
 */
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "@id": `${baseUrl}/#website`,
  url: baseUrl,
  name: seo.siteName,
  description: seo.organization.description,
  publisher: {
    "@id": `${baseUrl}/#organization`,
  },
  inLanguage: [lang === "en" ? "en-US" : "es-ES"],
  potentialAction: {
    "@type": "SearchAction",
    target: {
      "@type": "EntryPoint",
      urlTemplate: `${baseUrl}/search?q={search_term_string}`,
    },
    "query-input": "required name=search_term_string",
  },
};

/**
 * Breadcrumb Schema for navigation
 */
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    {
      "@type": "ListItem",
      position: 1,
      name: "Home",
      item: baseUrl,
    },
  ],
};
---

<!-- Core Meta Tags -->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="theme-color" content="#1BC3C7" />

<!-- Primary Meta Tags -->
<title>{fullTitle}</title>
<meta name="title" content={fullTitle} />
<meta name="description" content={description} />
<meta name="keywords" content={seo.keywords} />
<meta name="author" content={seo.siteName} />

<!-- Favicon and App Icons -->
<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="manifest" href="/site.webmanifest" />

<!-- Language and Canonical -->
<link rel="canonical" href={canonicalUrl} />
<link rel="alternate" hreflang={alternateLang} href={alternateUrl} />
<link rel="alternate" hreflang="x-default" href={`${baseUrl}/`} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website" />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:title" content={fullTitle} />
<meta property="og:description" content={description} />
<meta property="og:image" content={ogImage} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content={ogImageAlt} />
<meta property="og:locale" content={currentLocale} />
<meta property="og:locale:alternate" content={alternateLocale} />
<meta property="og:site_name" content={seo.siteName} />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalUrl} />
<meta name="twitter:title" content={fullTitle} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImage} />
<meta name="twitter:image:alt" content={ogImageAlt} />
<meta name="twitter:site" content={seo.twitterHandle} />
<meta name="twitter:creator" content={seo.twitterHandle} />

<!-- Additional SEO Tags -->
<meta
  name="robots"
  content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
/>
<meta name="googlebot" content="index, follow" />
<meta name="language" content={lang === "en" ? "English" : "Spanish"} />

<!-- AI-Related Meta Tags -->
<meta name="topic" content="Artificial Intelligence, Digital Transformation, Automation" />
<meta name="Classification" content="Business Services, Technology, AI Solutions" />
<meta name="coverage" content="Worldwide" />
<meta name="distribution" content="Global" />
<meta name="rating" content="General" />

<!-- Structured Data (JSON-LD) - Organization -->
<script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />

<!-- Structured Data (JSON-LD) - WebSite -->
<script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

<!-- Structured Data (JSON-LD) - Services -->
{
  serviceSchemas.map((schema) => (
    <script type="application/ld+json" set:html={JSON.stringify(schema)} />
  ))
}

<!-- Structured Data (JSON-LD) - Breadcrumb -->
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
